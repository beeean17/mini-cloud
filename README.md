# Mini Cloud

**Mini Cloud**λ” λ¦¬λ…μ¤ μ‹μ¤ν… ν”„λ΅κ·Έλλ°μ ν•µμ‹¬ κ°λ…(Socket, Fork, Signal, File I/O)μ„ ν™μ©ν•μ—¬ κµ¬ν„ν• **λ™μ‹μ„± νμΌ μ „μ†΅ μ‹μ¤ν…**μ…λ‹λ‹¤.
μ—¬λ¬ ν΄λΌμ΄μ–ΈνΈκ°€ λ™μ‹μ— μ ‘μ†ν•μ—¬ νμΌμ„ μ—…λ΅λ“, λ‹¤μ΄λ΅λ“, κ΄€λ¦¬ν•  μ μλ” ν΄λΌμ°λ“ μ¤ν† λ¦¬μ§€ μ„λΉ„μ¤μ ν•µμ‹¬ κΈ°λ¥μ„ μ κ³µν•©λ‹λ‹¤.

---

## π€ μ£Όμ” κΈ°λ¥ (Features)

### 1. νμΌ μ „μ†΅ λ° κ΄€λ¦¬
- **UPLOAD**: λ΅μ»¬ νμΌμ„ μ„λ²„λ΅ μ „μ†΅ν•©λ‹λ‹¤. μ›μμ (Atomic) νμΌ κµμ²΄λ¥Ό ν†µν•΄ μ „μ†΅ μ¤‘ μ¤λ¥κ°€ λ°μƒν•΄λ„ κΈ°μ΅΄ νμΌμ΄ μ†μƒλμ§€ μ•μµλ‹λ‹¤.
- **DOWNLOAD**: μ„λ²„μ— μ €μ¥λ νμΌμ„ λ΅μ»¬λ΅ λ‹¤μ΄λ΅λ“ν•©λ‹λ‹¤.
- **DOWNLOAD ALL**: μ„λ²„μ— μλ” λ¨λ“  νμΌμ„ ν• λ²μ— λ‹¤μ΄λ΅λ“ν•©λ‹λ‹¤.
- **LIST**: μ„λ²„μ— μ €μ¥λ νμΌ λ©λ΅μ„ μ΅°νν•©λ‹λ‹¤.
- **DELETE**: μ„λ²„μ— μ €μ¥λ νμΌμ„ μ‚­μ ν•©λ‹λ‹¤.

### 2. λ™μ‹μ„± μ²λ¦¬ (Concurrency)
- **Multi-Client Support**: `fork()`λ¥Ό μ‚¬μ©ν•μ—¬ κ° ν΄λΌμ΄μ–ΈνΈ μ ‘μ†λ§λ‹¤ λ…λ¦½μ μΈ μμ‹ ν”„λ΅μ„Έμ¤λ¥Ό μƒμ„±, λ‹¤μμ ν΄λΌμ΄μ–ΈνΈκ°€ λ™μ‹μ— μ‘μ—…μ„ μν–‰ν•  μ μμµλ‹λ‹¤.
- **Zombie Process Prevention**: `SIGCHLD` μ‹κ·Έλ„μ„ ν•Έλ“¤λ§ν•μ—¬ μΆ…λ£λ μμ‹ ν”„λ΅μ„Έμ¤ μμ›μ„ μ¦‰μ‹ νμν•©λ‹λ‹¤.

### 3. λ³΄μ• λ° μ•μ •μ„±
- **Token Authentication**: μ„λ²„μ™€ ν΄λΌμ΄μ–ΈνΈ κ°„ κ³µμ λ λΉ„λ°€ ν† ν°(Secret Token)μ„ ν†µν•΄ μΈκ°€λ μ‚¬μ©μλ§ μ ‘μ†μ„ ν—μ©ν•©λ‹λ‹¤.
- **Path Traversal Protection**: `../`μ™€ κ°™μ€ κ²½λ΅ μ΅°μ‘ μ‹λ„λ¥Ό μ°¨λ‹¨ν•μ—¬ μ„λ²„ νμΌ μ‹μ¤ν…μ„ λ³΄νΈν•©λ‹λ‹¤.
- **Upload Size Limit**: μ„λ²„ λ””μ¤ν¬ λ³΄νΈλ¥Ό μ„ν•΄ μ—…λ΅λ“ νμΌμ μµλ€ ν¬κΈ°λ¥Ό μ ν•ν•  μ μμµλ‹λ‹¤.

---

## π›  μ‚¬μ© λ°©λ²• (Usage)

### 1. λΉλ“ (Build)
ν”„λ΅μ νΈ λ£¨νΈ λ””λ ‰ν† λ¦¬μ—μ„ `make`λ¥Ό μ‹¤ν–‰ν•μ—¬ μ„λ²„μ™€ ν΄λΌμ΄μ–ΈνΈλ¥Ό λΉλ“ν•©λ‹λ‹¤.

```bash
make clean
make all
```
λΉλ“κ°€ μ™„λ£λλ©΄ `bin/` λ””λ ‰ν† λ¦¬μ— μ‹¤ν–‰ νμΌμ΄ μƒμ„±λ©λ‹λ‹¤.

### 2. μ„λ²„ μ‹¤ν–‰ (Server)
μ„λ²„λ¥Ό μ‹¤ν–‰ν•  ν¬νΈ λ²νΈλ¥Ό μ§€μ •ν•μ—¬ μ‹¤ν–‰ν•©λ‹λ‹¤. (μ„ νƒμ μΌλ΅ μ €μ¥μ† κ²½λ΅ μ§€μ • κ°€λ¥)

```bash
# κΈ°λ³Έ μ‹¤ν–‰ (ν¬νΈ 9000)
./bin/server 9000

# μ €μ¥μ† κ²½λ΅ μ§€μ • μ‹¤ν–‰
./bin/server 9000 ./my_storage
```

**ν™κ²½ λ³€μ μ„¤μ • (μµμ…):**
- `MC_SERVER_TOKEN`: μΈμ¦ ν† ν° μ„¤μ • (μ: `export MC_SERVER_TOKEN=secret123`)
- `MC_MAX_UPLOAD_BYTES`: μ—…λ΅λ“ μ©λ‰ μ ν• (λ°”μ΄νΈ λ‹¨μ„)

### 3. ν΄λΌμ΄μ–ΈνΈ μ‹¤ν–‰ (Client)
μ„λ²„μ IP μ£Όμ†μ™€ ν¬νΈ λ²νΈλ¥Ό μ…λ ¥ν•μ—¬ μ ‘μ†ν•©λ‹λ‹¤.

```bash
./bin/client 127.0.0.1 9000
```

**μΈμ¦ ν† ν° μ‚¬μ© μ‹:**
```bash
# ν™κ²½ λ³€μλ΅ ν† ν° μ „λ‹¬
export MC_CLIENT_TOKEN=secret123
./bin/client 127.0.0.1 9000
```

### 4. CLI λ…λ Ήμ–΄
μ ‘μ† ν›„ λ‹¤μκ³Ό κ°™μ€ λ…λ Ήμ–΄λ¥Ό μ‚¬μ©ν•  μ μμµλ‹λ‹¤.

```bash
mini-cloud> LIST                  # νμΌ λ©λ΅ μ΅°ν
mini-cloud> UPLOAD file.txt       # νμΌ μ—…λ΅λ“
mini-cloud> DOWNLOAD file.txt     # νμΌ λ‹¤μ΄λ΅λ“
mini-cloud> DOWNLOAD ALL          # μ „μ²΄ νμΌ λ‹¤μ΄λ΅λ“
mini-cloud> DELETE file.txt       # νμΌ μ‚­μ 
mini-cloud> QUIT                  # μΆ…λ£
```

---

## β™οΈ κµ¬ν„ μƒμ„Έ (Implementation Details)

μ΄ ν”„λ΅μ νΈλ” λ¦¬λ…μ¤ μ‹μ¤ν… μ½μ„ μ§μ ‘ μ‚¬μ©ν•μ—¬ μ €μμ¤€(Low-level) λ™μ‘ μ›λ¦¬λ¥Ό μ΄ν•΄ν•κ³  κµ¬ν„ν•λ” λ° μ΄μ μ„ λ§μ·„μµλ‹λ‹¤.

### 1. μ‹μ¤ν… μ•„ν‚¤ν…μ²
- **Client-Server Model**: TCP/IP μ†μΌ“μ„ κΈ°λ°μΌλ΅ ν†µμ‹ ν•©λ‹λ‹¤.
- **Process-based Concurrency**: `fork()` μ‹μ¤ν… μ½μ„ μ‚¬μ©ν•μ—¬ 'Connection per Process' λ¨λΈμ„ κµ¬ν„ν–μµλ‹λ‹¤. μ΄λ” κµ¬ν„μ΄ μ§κ΄€μ μ΄κ³  ν”„λ΅μ„Έμ¤ κ°„ λ©”λ¨λ¦¬κ°€ κ²©λ¦¬λμ–΄ μμ–΄ ν• ν΄λΌμ΄μ–ΈνΈμ ν¬λμ‹κ°€ μ„λ²„ μ „μ²΄μ— μν–¥μ„ μ£Όμ§€ μ•λ” μ¥μ μ΄ μμµλ‹λ‹¤.

### 2. ν•µμ‹¬ μ‹μ¤ν… μ½ (System Calls)

#### λ„¤νΈμ›ν¬ ν†µμ‹ 
- `socket()`, `bind()`, `listen()`: μ„λ²„ μ†μΌ“ μƒμ„± λ° λ€κΈ°
- `accept()`: ν΄λΌμ΄μ–ΈνΈ μ—°κ²° μλ½
- `connect()`: ν΄λΌμ΄μ–ΈνΈμ μ„λ²„ μ ‘μ†

#### ν”„λ΅μ„Έμ¤ μ μ–΄
- `fork()`: ν΄λΌμ΄μ–ΈνΈ μ²λ¦¬λ¥Ό μ„ν• μμ‹ ν”„λ΅μ„Έμ¤ μƒμ„±
- `waitpid()`: `SIGCHLD` μ‹κ·Έλ„ ν•Έλ“¤λ¬ λ‚΄μ—μ„ νΈμ¶ν•μ—¬ μΆ€λΉ„ ν”„λ΅μ„Έμ¤ μ κ±°
- `sigaction()`: `SIGCHLD`(μμ‹ μΆ…λ£), `SIGPIPE`(μ—°κ²° λ‹¨μ ) λ“± μ‹κ·Έλ„ μ²λ¦¬ μ„¤μ •

#### νμΌ μ…μ¶λ ¥
- `open()`, `read()`, `write()`, `close()`: κΈ°λ³Έμ μΈ νμΌ μ½κΈ°/μ“°κΈ°
- `rename()`: **μ›μμ  νμΌ κµμ²΄**λ¥Ό μ„ν•΄ μ‚¬μ©. μ„μ‹ νμΌμ— μ—…λ΅λ“λ¥Ό μ™„λ£ν• ν›„ μ›λ³Έ νμΌλ…μΌλ΅ κµμ²΄ν•μ—¬, μ „μ†΅ μ¤‘λ‹¨ μ‹ λ¶μ™„μ „ν• νμΌμ΄ λ‚¨λ” κ²ƒμ„ λ°©μ§€ν•©λ‹λ‹¤.
- `unlink()`: νμΌ μ‚­μ  λ° μ„μ‹ νμΌ μ •λ¦¬
- `opendir()`, `readdir()`: λ””λ ‰ν† λ¦¬ λ‚΄ νμΌ λ©λ΅ μ΅°ν

### 3. ν”„λ΅ν† μ½ (Protocol)
λ°”μ΄λ„λ¦¬ κΈ°λ°μ λ…μμ μΈ ν”„λ΅ν† μ½μ„ μ„¤κ³„ν•μ—¬ μ¤λ²„ν—¤λ“λ¥Ό μµμ†ν™”ν–μµλ‹λ‹¤.

```c
typedef struct {
    uint32_t magic;        // ν”„λ΅ν† μ½ μ‹λ³„μ (Magic Number)
    uint8_t  version;      // ν”„λ΅ν† μ½ λ²„μ „
    uint8_t  command;      // λ…λ Ήμ–΄ (UPLOAD, DOWNLOAD, LIST, ...)
    uint32_t filename_len; // νμΌλ… κΈΈμ΄
    uint64_t payload_len;  // λ°μ΄ν„°(Payload) ν¬κΈ°
} mc_packet_header_t;
```
- **Endianness Handling**: `htonl()`, `ntohl()` λ“±μ„ μ‚¬μ©ν•μ—¬ λ„¤νΈμ›ν¬ λ°”μ΄νΈ μ¤λ”(Big-endian)λ¥Ό μ¤€μ, μ„λ΅ λ‹¤λ¥Έ μ•„ν‚¤ν…μ² κ°„μ νΈν™μ„±μ„ λ³΄μ¥ν•©λ‹λ‹¤.

---

## π“‚ λ””λ ‰ν† λ¦¬ κµ¬μ΅°

```
mini-cloud/
β”β”€β”€ include/          # ν—¤λ” νμΌ (ν”„λ΅ν† μ½, μ„λ²„/ν΄λΌμ΄μ–ΈνΈ μΈν„°νμ΄μ¤)
β”β”€β”€ src/
β”‚   β”β”€β”€ client/       # ν΄λΌμ΄μ–ΈνΈ μ†μ¤ μ½”λ“
β”‚   β”β”€β”€ server/       # μ„λ²„ μ†μ¤ μ½”λ“
β”‚   β””β”€β”€ common/       # κ³µν†µ μ ν‹Έλ¦¬ν‹° (ν”„λ΅ν† μ½ μ²λ¦¬ λ“±)
β”β”€β”€ scripts/          # λ°°ν¬ λ° μ ν‹Έλ¦¬ν‹° μ¤ν¬λ¦½νΈ
β””β”€β”€ tests/            # ν…μ¤νΈ μ½”λ“ λ° μ¤ν¬λ¦½νΈ
```